<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fraud detection </title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav id="top">
        <ul >
            <li><img src="img/Onlinepayment.png" id="icon" alt=""></li>
            <li><p>Hello <span>`${user}`</span></p></li>
            <li id="end"><a href="logspage.html">log out</a></li>
        </ul>
    </nav>


        <ul id="container1">
            <li><div  id="li1">
                <ul id="navigation">
                   <li id="list"><a href="payment.html">Payment</a></li>
                   <li id="list"><a href="transaction.html">transaction</a></li>
                   <li  id="list"><a href="#" onclick="locationChangeNotifier()">reviews</a></li>
                   <li  id="list"><a href="report.html">Report</a></li>

                </ul>
            </div>
        </li>
        <li><div  id="li2">
            
            <p>use the navigation links to explore </p>

            <br>
            <a href="quickreview.html" onclick=""><button id="reviews">quick reviews </button></a>
           

        </div></li>
            <li ><div  id="li3">
                <p>reviews will go here</p>
                
            </div></li>
        </ul>
 <script type="text/javascript">

   



 function userAuth(){
    // Import mysql2 package
const mysql = require('mysql2');

// Create database connection
const connection = mysql.createConnection({
    host: 'localhost',
    user: 'root',
    password: '', // Empty password as specified
    database: 'your_database_name' // Replace with your actual database name
});

// Connect to database
connection.connect((err) => {
    if (err) {
        console.error('Database connection failed:', err.message);
        return;
    }
    console.log('Connected to MySQL database');
});

// Function to check if user is registered
function checkRegistration(userId) {
    return new Promise((resolve, reject) => {
        try {
            // Validate userId
            if (!userId || typeof userId !== 'number') {
                throw new Error('Invalid user ID');
            }

            // Query to check registration status
            const query = 'SELECT * FROM users WHERE id = ? AND is_registered = 1';
            connection.query(query, [userId], (err, results) => {
                if (err) {
                    reject(new Error('Database error: ' + err.message));
                    return;
                }

                if (results.length === 0) {
                    resolve('User not registered or not found. Please register first.');
                    return;
                }

                console.log(`Registration check passed for user ID ${userId}`);
                resolve(processUserData(userId));
            });

        } catch (error) {
            console.error('Registration check failed:', error.message);
            resolve('Error checking registration status');
        }
    });
}

// Outer function - process user data
function processUserData(userId) {
    return new Promise((resolve, reject) => {
        try {
            console.log('Outer function: Processing user data for ID:', userId);
            updateUserProfile(userId)
                .then(result => {
                    resolve(`User data processed successfully. ${result}`);
                })
                .catch(error => {
                    reject(error);
                });
        } catch (error) {
            console.error('Outer function failed:', error.message);
            resolve('Processing failed');
        }
    });
}

// Inner function - update profile
function updateUserProfile(userId) {
    return new Promise((resolve, reject) => {
        try {
            // Query to check if profile exists and update it
            const checkQuery = 'SELECT profile_data FROM profiles WHERE user_id = ?';
            connection.query(checkQuery, [userId], (err, results) => {
                if (err) {
                    reject(new Error('Database error: ' + err.message));
                    return;
                }

                if (results.length === 0) {
                    reject(new Error('Profile not found'));
                    return;
                }

                // Simulate profile update
                const updateQuery = 'UPDATE profiles SET last_updated = NOW() WHERE user_id = ?';
                connection.query(updateQuery, [userId], (err) => {
                    if (err) {
                        reject(new Error('Profile update failed: ' + err.message));
                        return;
                    }

                    console.log('Inner function: Profile updated for user ID', userId);
                    resolve(`Profile updated for user ID ${userId}`);
                });
            });

        } catch (error) {
            console.error('Inner function failed:', error.message);
            resolve('Profile update failed');
        }
    });
}

// Test cases
async function runTests() {
    console.log('\nTest 1: Registered user with profile');
    console.log(await checkRegistration(1));

    console.log('\nTest 2: Invalid input');
    console.log(await checkRegistration('invalid'));

    console.log('\nTest 3: Non-existent or unregistered user');
    console.log(await checkRegistration(999));
}

// Run tests
runTests();

// Close connection when done (optional)
process.on('SIGINT', () => {
    connection.end();
    console.log('Database connection closed');
    process.exit();
});

 }
 </script>
</body>
</html>