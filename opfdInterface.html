<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>opfd</title>
    <style>
        *{
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }
        body{
            border-color: white;
            display: flex;
            flex-direction: column;
            font-size: 17px;
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        }
        .container{
            color: black;
            background-color: white;
            border:1px solid black;
            box-shadow: 0 15px 35px rgb(76, 78, 189);
            width: 75vw;
            height: 70vh;
            margin-top:10vh ;
            margin-left: 10vw;
        }
        .screen{
            width: 100%;
            height: 85%;
            border-bottom: 1px solid rgb(31, 24, 24);
        }
        button{
            color: rgb(255, 255, 255);
            width:200px ;
            height: 30px;
            background-color: rgb(31, 31, 201);
            font-size: 16px;
            border-radius: 5px;
        }
        button:hover{
            background-color: cyan;
            color: black;
        }
        .container ul{
            width: 100%;
            margin: 0 auto;
        }
        .container ul li{
            list-style-type: none;
            display: inline-block;
            gap: 20px;
            margin-left: 40px;
            justify-content: space-around;
            margin-top: 20px;
        }
        #log-out{
            border: none;
            background-color: transparent;
            color: red;
            margin-left: 85%;
        }
        a{
            text-decoration: none;
            text-transform: capitalize;
            color: red;
        }
        a:hover{
            color: cyan;
            animation:ease-in-out .5s;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="screen" id="screen">
            <button id="log-out"><a href="logspage.html">log out</a></button>
       <div id="reviews">
        <p>logged in at  <span id="hours"></span>:<span id="minutes"></span>:<span id="sec"></span></p>
        <p>device logged ip >><span id="ipaddress"></span></p>
       </div>
        </div>
        <ul>
           <li> <button onclick="" id="payment">payment</button></li>
           <li> <button onclick=""id="transactions">transcations</button></li>
           <li> <button onclick="locationChangeNotifier() "id="reviews">review</button></li>
           <li> <button onclick=""id="report">report</button></li>
        </ul>
    </div>
    <script type="text/javascript">
         function locationChangeNotifier() {
    // Check if browser supports both Notification and Geolocation APIs
    if (!("Notification" in window) || !("geolocation" in navigator)) {
        console.log("This browser doesn't support notifications or geolocation");
        return;
    }

    // Request notification permission
    Notification.requestPermission().then(permission => {
        if (permission !== "granted") {
            console.log("Notification permission denied");
            return;
        }

        // Store previous position
        let previousPosition = null;

        // Options for geolocation watching
        const geoOptions = {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 0
        };

        // Function to calculate distance between two coordinates (in kilometers)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth's radius in kilometers
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Watch position changes
        navigator.geolocation.watchPosition(
            (position) => {
                const currentPosition = {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude,
                    timestamp: new Date(position.timestamp)
                };

                // If we have a previous position, check if location changed significantly
                if (previousPosition) {
                    const distance = calculateDistance(
                        previousPosition.latitude,
                        previousPosition.longitude,
                        currentPosition.latitude,
                        currentPosition.longitude
                    );

                    // Notify if moved more than 0.1 km (100 meters)
                    if (distance > 0.1) {
                        const notification = new Notification("Location Changed!", {
                            body: `Moved ${distance.toFixed(2)} km\nNew position: ${currentPosition.latitude.toFixed(4)}, ${currentPosition.longitude.toFixed(4)}`,
                            icon: 'http://127.0.0.1:5500/Online-Payment-Fraud-Detection/page1.html' // Optional: add your own icon URL
                        });

                        // Optional: Log to console
                        console.log(`Location changed by ${distance.toFixed(2)} km`);
                    }
                }

                // Update previous position
                previousPosition = currentPosition;
            },
            (error) => {
                console.error("Geolocation error:", error.message);
                new Notification("Location Error", {
                    body: `Unable to track location: ${error.message}`

                });
            },
            geoOptions
        );
    });
}
function time(){
    const now=new Date();
    const hours=now.getHours().toString().padStart(2, '0');
    const minutes=now.getMinutes().toString().padStart(2, '0');
    const seconds=now.getSeconds().toString().padStart(2, '0');

    document.getElementById("hours").textContent=hours;
    document.getElementById("minutes").textContent=minutes;
    document.getElementById("sec").textContent=seconds;

}
time();
function getip(){
    // Function to get IP address
async function getIPAddress() {
    try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        document.getElementById('ipaddress').textContent = data.ip;
        return data.ip;
    } catch (error) {
        console.error('Error fetching IP:', error);
        document.getElementById('ipaddress').textContent = 'Unable to get IP';
    }
}

    getIPAddress();
  
}
getip();
    </script>
</body>
</html>